---
import BaseLayout from '../layouts/BaseLayout.astro';
import NewsCard from '../components/NewsCard.astro';
import CategoryTag from '../components/CategoryTag.astro';
import { SITE_TITLE, SITE_DESCRIPTION, CATEGORIES } from '../consts';
import { getAllArticles } from '../utils/contentApi.js';

// Obtener artículos de la API
const allArticles = await getAllArticles();

// Ordenar por fecha de publicación (más reciente primero)
const sortedArticles = allArticles.sort(
  (a, b) => new Date(b.pubDate).valueOf() - new Date(a.pubDate).valueOf()
);

// Obtener artículos destacados (los 3 más recientes)
const featuredNews = sortedArticles.slice(0, 3).map(article => ({
  title: article.title,
  description: article.description,
  pubDate: new Date(article.pubDate),
  category: article.category,
  image: article.featured_image || "/blog-placeholder-3.jpg", // Usar imagen destacada o placeholder
  slug: article.slug,
  featured: sortedArticles.indexOf(article) === 0 // El primer artículo es el destacado principal
}));

// Obtener artículos recientes (los siguientes 6 después de los destacados)
const recentNews = sortedArticles.slice(3, 9).map(article => ({
  title: article.title,
  description: article.description,
  pubDate: new Date(article.pubDate),
  category: article.category,
  image: article.featured_image || "/blog-placeholder-1.jpg", // Usar imagen destacada o placeholder
  slug: article.slug
}));

// Mensaje para mostrar si no hay artículos
const noArticlesMessage = "No hay artículos disponibles en este momento. Por favor, vuelva a intentarlo más tarde.";
---

<BaseLayout>
  <!-- Hero Section -->
  <section class="hero">
    <div class="hero-overlay">
      <div class="container">
        <h1>Voces del Campo</h1>
        <p>Noticias e historias del colectivo agrario Abya Yala</p>
      </div>
    </div>
  </section>

  <!-- Featured News Section -->
  <section class="featured-news">
    <div class="container">
      <h2 class="section-title">Noticias Destacadas</h2>
      {featuredNews.length > 0 ? (
        <div class="featured-grid">
          {featuredNews.map(news => (
            <NewsCard 
              title={news.title}
              description={news.description}
              pubDate={news.pubDate}
              category={news.category}
              image={news.image}
              slug={news.slug}
              featured={news.featured}
            />
          ))}
        </div>
      ) : (
        <div class="no-content-message">
          <p>{noArticlesMessage}</p>
        </div>
      )}
    </div>
  </section>

  <!-- Categories Section -->
  <section class="categories-section">
    <div class="container">
      <h2 class="section-title">Explora por Categorías</h2>
      <div class="categories-grid">
        {CATEGORIES.map(category => (
          <a href={`/category/${category.id}`} class="category-card">
            <h3>{category.name}</h3>
            <p>{category.description}</p>
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- Recent News Section -->
  <section class="recent-news">
    <div class="container">
      <h2 class="section-title">Noticias Recientes</h2>
      {recentNews.length > 0 ? (
        <div class="news-grid">
          {recentNews.map(news => (
            <NewsCard 
              title={news.title}
              description={news.description}
              pubDate={news.pubDate}
              category={news.category}
              image={news.image}
              slug={news.slug}
            />
          ))}
        </div>
      ) : (
        <div class="no-content-message">
          <p>{noArticlesMessage}</p>
        </div>
      )}
      <div class="view-all">
        <a href="/news" class="btn-primary">Ver todas las noticias</a>
      </div>
    </div>
  </section>

  <!-- Impact Section -->
  <section class="impact-section">
    <div class="container">
      <h2 class="section-title">Nuestro Impacto</h2>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-number">500+</div>
          <div class="stat-label">Familias Agricultoras</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">15</div>
          <div class="stat-label">Años de Experiencia</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">30+</div>
          <div class="stat-label">Proyectos Comunitarios</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">1000+</div>
          <div class="stat-label">Hectáreas Sostenibles</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Call to Action -->
  <section class="cta-section">
    <div class="container">
      <h2>Únete a Nuestra Comunidad</h2>
      <p>Recibe actualizaciones sobre nuestras actividades y noticias del sector agrario</p>
      <form class="newsletter-form">
        <input type="email" placeholder="Tu correo electrónico" required>
        <button type="submit" class="btn-primary">Suscribirse</button>
      </form>
    </div>
  </section>
</BaseLayout>

<style>
  /* Hero Section */
  .hero {
    position: relative;
    height: 80vh;
    min-height: 500px;
    background-image: url('/hero-agriculture.jpg');
    background-size: cover;
    background-position: center;
    color: white;
    display: flex;
    align-items: center;
    text-align: center;
  }

  .hero-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.7));
    display: flex;
    align-items: center;
  }

  .hero h1 {
    font-size: 3.5rem;
    font-weight: 700;
    margin-bottom: 1rem;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
  }

  .hero p {
    font-size: 1.5rem;
    max-width: 800px;
    margin: 0 auto;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
  }

  /* Featured News Section */
  .featured-news {
    padding: 4rem 0;
  }

  .section-title {
    font-size: 2rem;
    margin-bottom: 2rem;
    position: relative;
    padding-bottom: 0.5rem;
  }

  .section-title::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 80px;
    height: 3px;
    background-color: var(--color-accent);
  }

  .featured-grid {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 1.5rem;
  }

  /* Categories Section */
  .categories-section {
    padding: 4rem 0;
    background-color: var(--color-bg-alt);
  }

  .categories-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 1.5rem;
  }

  .category-card {
    background-color: var(--color-background);
    border-radius: 8px;
    padding: 1.5rem;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    text-decoration: none;
    color: var(--color-text);
  }

  .category-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.15);
  }

  .category-card h3 {
    font-size: 1.25rem;
    margin-bottom: 0.5rem;
    color: var(--color-primary);
  }

  /* Recent News Section */
  .recent-news {
    padding: 4rem 0;
  }

  .news-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  .view-all {
    text-align: center;
    margin-top: 2rem;
  }

  .btn-primary {
    background-color: var(--color-primary);
    color: white;
    padding: 0.75rem 1.5rem;
    border-radius: 4px;
    text-decoration: none;
    font-weight: 600;
    display: inline-block;
    transition: background-color 0.3s ease;
  }

  .btn-primary:hover {
    background-color: var(--color-primary-dark);
  }

  /* Impact Section */
  .impact-section {
    padding: 4rem 0;
    background-color: var(--color-bg-alt);
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1.5rem;
  }

  .stat-card {
    background-color: var(--color-background);
    border-radius: 8px;
    padding: 2rem 1.5rem;
    text-align: center;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  }

  .stat-number {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--color-primary);
    margin-bottom: 0.5rem;
  }

  .stat-label {
    font-size: 1.1rem;
    color: var(--color-text-muted);
  }

  /* Call to Action Section */
  .cta-section {
    padding: 4rem 0;
    background-color: var(--color-primary);
    color: white;
    text-align: center;
  }

  .cta-section h2 {
    font-size: 2rem;
    margin-bottom: 1rem;
  }

  .cta-section p {
    font-size: 1.2rem;
    max-width: 700px;
    margin: 0 auto 2rem;
  }

  .newsletter-form {
    display: flex;
    max-width: 500px;
    margin: 0 auto;
  }

  .newsletter-form input {
    flex: 1;
    padding: 0.75rem 1rem;
    border: none;
    border-radius: 4px 0 0 4px;
    font-size: 1rem;
  }

  .newsletter-form button {
    border: none;
    border-radius: 0 4px 4px 0;
    cursor: pointer;
  }

  /* No Content Message */
  .no-content-message {
    background-color: var(--color-bg-alt);
    padding: 2rem;
    text-align: center;
    border-radius: 8px;
    margin: 1rem 0;
  }

  .no-content-message p {
    font-size: 1.1rem;
    color: var(--color-text-muted);
  }

  /* Responsive Styles */
  @media (max-width: 992px) {
    .featured-grid {
      grid-template-columns: 1fr 1fr;
    }

    .stats-grid {
      grid-template-columns: repeat(2, 1fr);
    }

    .hero h1 {
      font-size: 2.8rem;
    }
  }

  @media (max-width: 768px) {
    .news-grid {
      grid-template-columns: repeat(2, 1fr);
    }

    .newsletter-form {
      flex-direction: column;
    }

    .newsletter-form input,
    .newsletter-form button {
      width: 100%;
      border-radius: 4px;
    }

    .newsletter-form button {
      margin-top: 1rem;
    }

    .hero {
      height: 60vh;
    }

    .hero h1 {
      font-size: 2.2rem;
    }

    .hero p {
      font-size: 1.2rem;
    }
  }

  @media (max-width: 576px) {
    .featured-grid,
    .news-grid {
      grid-template-columns: 1fr;
    }

    .section-title {
      font-size: 1.75rem;
    }

    .hero {
      height: 50vh;
    }
  }
</style>
