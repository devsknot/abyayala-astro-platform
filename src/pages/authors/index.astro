--- 
// src/pages/authors/index.astro
import BaseLayout from '../../layouts/BaseLayout.astro';

// Fetch all authors from the API
// We use the full URL here because this code runs on the server during the build.
const response = await fetch(`${Astro.url.origin}/api/content/authors`);
let authors = [];
if (response.ok) {
  const data = await response.json();
  authors = data.authors || [];
} else {
  console.error('Failed to fetch authors:', await response.text());
}

const pageTitle = "Nuestros Autores";
const pageDescription = "Conoce al increíble equipo de escritores, investigadores y activistas que dan vida a Abya Yala.";
---

<BaseLayout title={pageTitle} description={pageDescription}>
  <div class="bg-gray-50">
    <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
      <div class="text-center">
        <h1 class="text-4xl font-extrabold text-gray-900 sm:text-5xl md:text-6xl">
          {pageTitle}
        </h1>
        <p class="mt-3 max-w-md mx-auto text-lg text-gray-500 sm:text-xl md:mt-5 md:max-w-3xl">
          {pageDescription}
        </p>
      </div>

      {authors.length > 0 ? (
        <div class="mt-12 grid gap-8 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">
          {authors.map(author => (
            <div class="bg-white rounded-lg shadow-lg overflow-hidden transform hover:scale-105 transition-transform duration-300">
              <a href={`/authors/${author.slug}`} class="block">
                <div class="h-48 bg-gray-200">
                  <img 
                    class="w-full h-full object-cover" 
                    src={author.avatar || `https://ui-avatars.com/api/?name=${encodeURIComponent(author.name)}&background=random&color=fff`}
                    alt={`Avatar de ${author.name}`}
                  />
                </div>
                <div class="p-6">
                  <h3 class="text-xl font-semibold text-gray-900">{author.name}</h3>
                  {author.bio && (
                    <p class="mt-2 text-gray-600 line-clamp-3">{author.bio}</p>
                  )}
                </div>
              </a>
            </div>
          ))}
        </div>
      ) : (
        <div class="mt-12 text-center">
          <p class="text-xl text-gray-500">No se encontraron autores. Por favor, inténtalo de nuevo más tarde.</p>
        </div>
      )}
    </div>
  </div>
</BaseLayout>
